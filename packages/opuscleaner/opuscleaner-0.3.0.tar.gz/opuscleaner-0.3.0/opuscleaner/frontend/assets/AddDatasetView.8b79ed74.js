var B=(t,n,o)=>{if(!n.has(t))throw TypeError("Cannot "+o)};var w=(t,n,o)=>(B(t,n,"read from private field"),o?o.call(t):n.get(t)),A=(t,n,o)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,o)},T=(t,n,o,c)=>(B(t,n,"write to private field"),c?c.call(t,o):n.set(t,o),o);var j=(t,n,o)=>(B(t,n,"access private method"),o);import{i as u,j as Y,k as Z,o as g,c as _,d as s,F,r as P,f as m,t as v,u as r,_ as ee,m as U,aL as te,n as b,bw as ae,a4 as $,bu as R,v as ne,b as y,bx as se,a as oe,T as le,bF as re,p as ie,h as ue}from"./index.aa84b8f1.js";import{C}from"./vue-select.973ce47f.js";function ce(t){const n=t==0?0:Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,n)).toFixed(2)+" "+["B","kB","MB","GB","TB"][n]}const z=u(0);async function L(t,n){try{return z.value+=1,await(await fetch(t,n)).json()}finally{z.value-=1}}var h,k,J;class de{constructor(n,o){A(this,k);A(this,h,void 0);this.interval=n,this.callback=o}start(){w(this,h)&&clearTimeout(w(this,h)),T(this,h,setTimeout(j(this,k,J).bind(this),this.interval))}stop(){clearTimeout(w(this,h)),T(this,h,null)}restart(){this.stop(),this.start()}}h=new WeakMap,k=new WeakSet,J=function(){Promise.resolve(this.callback()).then(()=>{w(this,h)&&this.start()})};const f=Y({});function pe(){return f}async function he(t){return await L("/api/download/downloads/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map(({id:n})=>({id:n})))})}async function q(){return await L("/api/download/downloads/")}function ve(t){he([t]).then(n=>{Object.assign(f,G(n))})}function ge(t){return t.id in f}async function me(){return await L("/api/download/languages/")}async function _e(t){return await L(`/api/download/languages/${encodeURIComponent(t)}`)}async function fe(t){return await L(`/api/download/by-language/${encodeURIComponent(t)}`)}let E=new de(1e3,async()=>{const t=await q();Object.assign(f,G(t))});Z(f,t=>{const n=new Set(["pending","downloading"]);Object.values(t).some(o=>n.has(o.state))?E.restart():E.stop()});function G(t){return Object.fromEntries(t.map(n=>[n.entry.id,n]))}q().then(t=>{Object.assign(f,G(t))});const we={class:"downloads-popup"},be=s("summary",null,[s("h2",null,"Downloads")],-1),ye={__name:"DownloadPopup",setup(t){return(n,o)=>(g(),_("details",we,[be,s("ul",null,[(g(!0),_(F,null,P(r(pe)(),c=>(g(),_("li",{key:c.entry.id},[m(v(c.entry.corpus)+" ",1),s("em",null,v(c.state),1)]))),128))])]))}};const I=t=>(ie("data-v-ec474531"),t=t(),ue(),t),Le={class:"downloader"},Ie=I(()=>s("h1",{class:"datasets-catalogue-title"},[m(" Datasets catalogue "),s("small",null,[s("em",null,"TODO"),m(" datasets")])],-1)),Oe={class:"search-inputs"},Ne=["value"],De=["value"],Ue={class:"dataset-list"},ke=["id"],Ve={class:"dataset-name"},Se={class:"dataset-title"},Me=["href"],Be=["onClick","disabled"],Ae={class:"metadata-dataset"},Te=I(()=>s("dt",null,"Version",-1)),$e={title:"Version"},Ce=I(()=>s("dt",null,"Languages",-1)),Ge={title:"Languages"},xe=I(()=>s("dt",null,"Pairs",-1)),je={title:"Sentence pairs"},Re=I(()=>s("dt",null,"Size",-1)),ze={title:"Download size"},Ee={__name:"AddDatasetView",setup(t){function n(l){return l!=""}const o={MONOLINGUAL:"monolingual",BILINGUAL:"bilingual"},c=[{label:"Corpus name",compare:(l,a)=>l.corpus.localeCompare(a.corpus)},{label:"Download size",compare:(l,a)=>a.size-l.size},{label:"Sentence pairs",compare:(l,a)=>a.pairs-l.pairs}],V=u(c[0]),S=new Map,M=new Map,O=u(""),N=u(!0),d=u(o.BILINGUAL),i=u(),D=u(),x=u(),H=U(()=>{if(!i.value)return[];if(!S.has(i.value)){const l=u([]);S.set(i.value,l),_e(i.value).then(a=>{l.value=a})}return S.get(i.value).value}),K=U(()=>{const l=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(x.value||[]).map(a=>{try{return{lang:a,label:`${l.of(a)} (${a})`}}catch{return{lang:a,label:a}}})}),Q=U(()=>{const l=new Intl.DisplayNames([],{type:"language",languageDisplay:"standard"});return(H.value||[]).map(a=>{try{return{lang:a,label:`${l.of(a)} (${a})`}}catch{return{lang:a,label:a}}})}),W=U(()=>{let l;switch(d.value){case o.BILINGUAL:if(!i.value||!D.value)return[];l=`${i.value}-${D.value}`;break;case o.MONOLINGUAL:if(!i.value)return[];l=`${i.value}`;break;default:throw new Error("Unknown preprocessing type")}if(!M.has(l)){const e=u([]);M.set(l,e),fe(l).then(p=>e.value=p)}let a=M.get(l).value;return O.value.length>0&&(a=a.filter(({corpus:e,group:p})=>e.toLowerCase().indexOf(O.value.toLowerCase())!==-1)),a=a.filter(e=>{switch(d.value){case o.BILINGUAL:return e.langs.filter(n).length>1;case o.MONOLINGUAL:return e.langs.filter(n).length==1;default:return!1}}),N.value&&(a=Array.from(a.reduce((e,p)=>((!e.has(p.corpus)||e.get(p.corpus).version<p.version)&&e.set(p.corpus,p),e),new Map).values())),a.sort(V.value.compare),a});te(async()=>{me().then(l=>{x.value=l})});const X=new Intl.NumberFormat;return(l,a)=>(g(),_("div",Le,[Ie,s("div",Oe,[s("label",null,[b(s("input",{type:"search",placeholder:"Search dataset\u2026","onUpdate:modelValue":a[0]||(a[0]=e=>O.value=e)},null,512),[[ae,O.value]])]),s("label",{class:$(["search-button",{checked:d.value==o.MONOLINGUAL}])},[b(s("input",{type:"radio",name:"preprocessing","onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),value:o.MONOLINGUAL},null,8,Ne),[[R,d.value]]),m(" Monolingual ")],2),s("label",{class:$(["search-button",{checked:d.value==o.BILINGUAL}])},[b(s("input",{type:"radio",name:"preprocessing","onUpdate:modelValue":a[2]||(a[2]=e=>d.value=e),value:o.BILINGUAL},null,8,De),[[R,d.value]]),m(" Bilingual ")],2),s("label",{class:$(["search-button",{checked:N.value}])},[b(s("input",{type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=e=>N.value=e)},null,512),[[ne,N.value]]),m(" Latest only ")],2),s("label",null,[y(r(C),{modelValue:i.value,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value=e),options:r(K),reduce:({lang:e})=>e,placeholder:"Origin language"},null,8,["modelValue","options","reduce"])]),b(s("label",null,[y(r(C),{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value=e),options:r(Q),reduce:({lang:e})=>e,placeholder:"Target language"},null,8,["modelValue","options","reduce"])],512),[[se,d.value==o.BILINGUAL]]),s("label",null,[y(r(C),{modelValue:V.value,"onUpdate:modelValue":a[6]||(a[6]=e=>V.value=e),options:c,placeholder:"Sort order"},null,8,["modelValue"])])]),s("div",Ue,[(g(!0),_(F,null,P(r(W),e=>(g(),_("div",{class:"dataset",key:e.id,id:`did-${e.id}`},[s("div",Ve,[s("h3",Se,[s("a",{href:`https://opus.nlpl.eu/${e.corpus}-${e.version}.php`,target:"_blank"},v(e.corpus),9,Me)]),s("button",{class:"download-dataset-button",onClick:p=>r(ve)(e),disabled:r(ge)(e)||"paths"in e},[m(" Download "),y(r(re),{class:"download-icon"})],8,Be)]),s("dl",Ae,[Te,s("dd",$e,v(e.version),1),Ce,s("dd",Ge,v(e.langs.filter(n).join("\u2192")),1),xe,s("dd",je,v(e.pairs?r(X).format(e.pairs):""),1),Re,s("dd",ze,v(e.size?r(ce)(e.size):""),1)])],8,ke))),128))]),(g(),oe(le,{to:".navbar"},[y(ye)]))]))}},qe=ee(Ee,[["__scopeId","data-v-ec474531"]]);export{qe as default};
