{
  "variables": {
    "metadata": ".",
    "extracted": ".extracted_metadata",
    "graph": ".extracted_metadata[\"@graph\"]?",
    "type_dataset": ".extracted_metadata[\"@graph\"]? | .[] | select(.[\"@type\"] == \"Dataset\")",
    "combinedpersonsids": ".extracted_metadata[\"@graph\"]? | {\"authordetails\": .[] | select(.[\"@id\"] == \"#personList\") | .[\"@list\"], \"authorids\": .[] | select(.[\"@type\"] == \"Dataset\") | .author}",
    "combinedpersonspubs": ".extracted_metadata[\"@graph\"]? | {\"authordetails\": .[] | select(.[\"@id\"] == \"#personList\") | .[\"@list\"], \"publications\": .[] | select(.[\"@id\"] == \"#publicationList\") | .[\"@list\"]}"
  },
  "properties": [
    {
      "name": "type",
      "program": ".type",
      "input": "metadata"
    },
    {
      "name": "dataset_id",
      "program": ".dataset_id",
      "input": "metadata"
    },
    {
      "name": "dataset_version",
      "program": ".dataset_version",
      "input": "metadata"
    },
    {
      "name": "name",
      "program": ".name",
      "input": "type_dataset"
    },
    {
      "name": "short_name",
      "program": null,
      "input": ""
    },
    {
      "name": "description",
      "program": ".description",
      "input": "type_dataset"
    },
    {
      "name": "doi",
      "program": null,
      "input": ""
    },
    {
      "name": "url",
      "program": ".url",
      "input": "type_dataset"
    },
    {
      "name": "license",
      "program": null,
      "input": {}
    },
    {
      "name": "authors",
      "program": ". as $parent | [.authorids[][\"@id\"] as $idin | ($parent.authordetails[] | select(.[\"@id\"] == $idin))]",
      "input": "combinedpersonsids"
    },
    {
      "name": "keywords",
      "program": ".keywords",
      "input": "type_dataset"
    },
    {
      "name": "funding",
      "program": ".[] | select(.[\"@type\"] == \"Dataset\") | [.funder[]? | {\"name\": .name, \"identifier\": \"\", \"description\": \"\"}]",
      "input": "graph"
    },
    {
      "name": "publications",
      "program": ". as $parent | [.publications[] as $pubin | {\"type\":$pubin[\"@type\"], \"title\":$pubin[\"headline\"], \"doi\":$pubin[\"sameAs\"], \"datePublished\":$pubin[\"datePublished\"], \"publicationOutlet\":$pubin[\"publication\"][\"name\"], \"authors\": ([$pubin.author[][\"@id\"] as $idin | ($parent.authordetails[] | select(.[\"@id\"] == $idin))])}]",
      "input": "combinedpersonspubs"
    },
    {
      "name": "subdatasets",
      "program": ".[]? | select(.[\"@type\"] == \"Dataset\") | [.hasPart[]? | {\"dataset_id\": (.identifier | sub(\"^datalad:\"; \"\")), \"dataset_version\": (.[\"@id\"] | sub(\"^datalad:\"; \"\")), \"dataset_path\": .name, \"dirs_from_path\": []}]",
      "input": "graph"
    },
    {
      "name": "children",
      "program": null,
      "input": []
    },
    {
      "name": "extractors_used",
      "program": "[{\"extractor_name\": .extractor_name, \"extractor_version\": .extractor_version, \"extraction_parameter\": .extraction_parameter, \"extraction_time\": .extraction_time, \"agent_name\": .agent_name, \"agent_email\": .agent_email,}]",
      "input": "metadata"
    }
  ]
}

