- name: include vars
  include_vars: ../defaults/main.yml

# 创建mindx-dl命名空间
- name: create mindx-dl namespace
  shell: "kubectl create namespace {{ MINDXDL_NAMESPACE }} || true"
  environment:
    http_proxy: ""
    https_proxy: ""
    HTTP_PROXY: ""
    HTTPS_PROXY: ""
  changed_when: false
  when:
    - inventory_hostname in groups['master'][0]


# 获取节点K8s版本
- name: get k8s version
  shell:
    cmd:
      echo $(kubelet --version 2>/dev/null || echo '') | awk '{print $2}' | sed  "s/v//" | awk -F"." '{print $2}';
  register: k8s_mid_version
  changed_when: false

- name: set fact for use_old_k8s
  set_fact:
    use_old_k8s_version: "{{ k8s_mid_version.stdout | int}} <= 21"
    cacheable: yes
