(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2287],{63153:function(e,r,n){"use strict";n.d(r,{Z3:function(){return t},ms:function(){return o},s7:function(){return i}});var t=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],i="password_current",o=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:i},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},20582:function(e,r,n){"use strict";var t=n(82394),i=n(21831),o=n(75582),u=n(21764),s=n(82684),l=n(83455),a=n(60328),d=n(79891),c=n(67971),p=n(87372),f=n(55378),v=n(86673),m=n(82944),w=n(82531),b=n(66166),h=n(63153),j=n(24224),y=n(9736),O=n(7715),_=n(96510),Z=n(28598);function g(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function x(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?g(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.entity,g=void 0===n?"global":n,P=e.entityID,C=e.hideFields,S=e.newUser,k=e.onDeleteSuccess,E=e.onSaveSuccess,I=e.showDelete,D=e.title,A=e.user,T=(0,s.useState)(!0),M=T[0],N=T[1],q=(0,s.useState)({}),R=q[0],F=q[1],U=(0,s.useState)(null),H=U[0],L=U[1],G=((0,y.PR)()||{}).owner,B=w.ZP.roles.list({entity:g,entity_ids:P?[P]:[],limit_roles:!!S},{revalidateOnFocus:!1}),V=B.data,W=(B.mutate,(0,s.useMemo)((function(){return(null===V||void 0===V?void 0:V.roles)||[]}),[null===V||void 0===V?void 0:V.roles])),X=(0,l.Db)(S?w.ZP.users.useCreate():w.ZP.users.useUpdate(null===A||void 0===A?void 0:A.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(e){var r=e.user,n=h.Z3.concat(h.ms).map((function(e){return e.uuid})),t=(0,O.GL)(r,n);L(t),u.Am.success(S?"New user created successfully.":"User profile successfully updated.",{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null===E||void 0===E||E(t)},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,i=r.message,o=r.type;u.Am.error((null===n||void 0===n?void 0:n.error)||t||i,{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:o})}})}}),z=(0,o.Z)(X,2),Q=z[0],J=z[1].isLoading,K=(0,l.Db)(w.ZP.users.useDelete(null===A||void 0===A?void 0:A.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(){null===k||void 0===k||k()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.message;alert(t),console.log(n)}})}}),Y=(0,o.Z)(K,2),$=Y[0],ee=Y[1].isLoading,re=C?(0,i.Z)(C):[];S&&re.push(h.s7);var ne=!re||!re.includes(h.s7),te=(0,b.Z)(A);(0,s.useEffect)((function(){if(A&&(!H||(null===te||void 0===te?void 0:te.id)!==(null===A||void 0===A?void 0:A.id))){var e=h.Z3.concat(h.ms).map((function(e){return e.uuid}));L((0,O.GL)(A,e))}null!==H&&void 0!==H&&H.password||null!==H&&void 0!==H&&H.password_confirmation?(null===H||void 0===H?void 0:H.password)!==(null===H||void 0===H?void 0:H.password_confirmation)?F({password_confirmation:"Password confirmation does not match."}):!ne||null!==H&&void 0!==H&&H.password_current?F(null):F({password_current:"This field is required."}):null!==H&&void 0!==H&&H.password_current&&ne?null!==H&&void 0!==H&&H.password&&null!==H&&void 0!==H&&H.password_confirmation?F(null):F({password:"This field is required.",password_confirmation:"This field is required."}):null!==H&&void 0!==H&&H.password_current||null!==H&&void 0!==H&&H.password||null!==H&&void 0!==H&&H.password_confirmation||F(null)}),[H,ne,A,te]);var ie=(0,s.useState)(!1),oe=ie[0],ue=ie[1],se=(0,s.useMemo)((function(){return(oe?null===H||void 0===H?void 0:H.roles_new:null===A||void 0===A?void 0:A.roles_new)||[]}),[H,oe,A]),le=(0,s.useMemo)((function(){var e=(null===W||void 0===W?void 0:W.map((function(e){return e.id})))||[];return null===se||void 0===se?void 0:se.filter((function(r){var n=r.id;return e.includes(n)}))}),[se,W]);return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(p.Z,{children:D||"Edit profile"}),(0,Z.jsxs)("form",{children:[h.Z3.filter((function(e){var r=e.uuid;return!re||!re.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,i=e.label,o=e.required,u=e.type,s=e.uuid;return(0,Z.jsx)(v.Z,{mt:2,children:(0,Z.jsx)(m.Z,{autoComplete:r,disabled:n&&!S,label:i,onChange:function(e){N(!1),L((function(r){return x(x({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:o,setContentOnMount:!0,type:u,value:(null===H||void 0===H?void 0:H[s])||""})},s)})),!(null!==A&&void 0!==A&&A.owner)&&(0,Z.jsxs)(v.Z,{mt:2,children:[(0,Z.jsx)(f.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){var r=(0,j.sE)(W,(function(r){return r.id==e.target.value}));r&&(N(!1),ue(!0),L((function(e){var n={};return(0,j.sE)(se,(function(e){return e.id==(null===r||void 0===r?void 0:r.id)}))||(n={roles_new:[].concat((0,i.Z)(se),[r])}),x(x({},e),n)})))},primary:!0,setContentOnMount:!0,children:W.map((function(e){var r=e.id,n=e.name;return(0,Z.jsx)("option",{value:r,children:n},n)}))}),(0,Z.jsx)(v.Z,{mb:1}),(0,Z.jsx)(c.Z,{alignItems:"center",flexWrap:"wrap",children:null===le||void 0===le?void 0:le.map((function(e){var n=e.id,t=e.name;return(0,Z.jsx)(v.Z,{mb:1,mr:1,children:(0,Z.jsx)(d.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:t,onClick:function(){N(!1),ue(!0),L((function(e){return x(x({},e),{},{roles_new:(0,j.Od)(se,(function(e){return e.id===n}))})}))},primary:!0})},"user_roles/".concat(t))}))})]}),(0,Z.jsxs)(v.Z,{mt:5,children:[(0,Z.jsx)(p.Z,{children:S?"Password":"Change password"}),h.ms.filter((function(e){var r=e.uuid;return!re||!re.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,i=e.label,o=e.required,u=e.type,s=e.uuid;return(0,Z.jsx)(v.Z,{mt:2,children:(0,Z.jsx)(m.Z,{autoComplete:r,disabled:n,label:i,meta:{error:null===R||void 0===R?void 0:R[s],touched:!(null===R||void 0===R||!R[s])},onChange:function(e){N(!1),L((function(r){return x(x({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:o,setContentOnMount:!0,type:u,value:(null===H||void 0===H?void 0:H[s])||""})},s)}))]}),(0,Z.jsx)(v.Z,{mt:5,children:(0,Z.jsxs)(c.Z,{children:[(0,Z.jsx)(a.Z,{disabled:M||R&&!(0,O.Qr)(R),loading:J,onClick:function(){var e,r=x({},H);"roles_new"in r&&(r.roles_new=null===(e=H.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));Q({user:r})},primary:!0,children:S?"Create new user":"Update user profile"}),I&&G&&(0,Z.jsx)(v.Z,{ml:1,children:(0,Z.jsx)(a.Z,{danger:!0,loading:ee,onClick:function(){window.confirm("Are you sure you want to delete ".concat(H.username||H.email,"?"))&&$()},children:"Delete user"})})]})})]})]})}},79891:function(e,r,n){"use strict";var t=n(38626),i=n(60328),o=n(67971),u=n(86673),s=n(19711),l=n(23831),a=n(10503),d=n(49125),c=n(31012),p=n(28598),f=t.default.div.withConfig({displayName:"Chip__ChipStyle",componentId:"sc-1ok73g-0"})(["display:inline-block;"," "," "," "," ",""],(function(e){return!e.primary&&"\n    background-color: ".concat((e.theme.background||l.Z.background).popup,";\n  ")}),(function(e){return e.primary&&"\n    background-color: ".concat((e.theme.chart||l.Z.chart).primary,";\n  ")}),(function(e){return!e.small&&"\n    border-radius: ".concat((d.iI+c.Al)/2,"px;\n    height: ").concat(1.5*d.iI+c.Al,"px;\n    padding: ").concat(d.iI/1.5,"px ").concat(1.25*d.iI,"px;\n  ")}),(function(e){return e.small&&"\n    border-radius: ".concat((d.iI/2+c.Al)/2,"px;\n    height: ").concat(c.Al+d.iI/2+2,"px;\n    padding: ").concat(d.iI/4,"px ").concat(d.iI,"px;\n  ")}),(function(e){return e.border&&"\n    border: 1px solid ".concat((e.theme.content||l.Z.content).muted,";\n  ")}));r.Z=function(e){var r=e.border,n=e.children,t=e.disabled,l=e.label,c=e.onClick,v=e.primary,m=e.small;return(0,p.jsx)(f,{border:r,primary:v,small:m,children:(0,p.jsx)(i.Z,{basic:!0,disabled:t,noBackground:!0,noPadding:!0,onClick:c,transparent:!0,children:(0,p.jsxs)(o.Z,{alignItems:"center",children:[n,l&&(0,p.jsx)(s.ZP,{small:m,children:l}),!t&&(0,p.jsx)(u.Z,{ml:1,children:(0,p.jsx)(a.x8,{default:v,muted:!v,size:m?d.iI:1.25*d.iI})})]})})})}},60921:function(e,r,n){"use strict";n.r(r);var t=n(77837),i=n(82394),o=n(38860),u=n.n(o),s=n(82684),l=n(34376),a=n(60328),d=n(87372),c=n(41788),p=n(30775),f=n(86673),v=n(87815),m=n(19711),w=n(20582),b=n(82531),h=n(66166),j=n(10503),y=n(49125),O=n(79585),_=n(63153),Z=n(9736),g=n(33766),x=n(7715),P=n(59e3),C=n(28598);function S(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function k(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?S(Object(n),!0).forEach((function(r){(0,i.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function E(){var e=(0,l.useRouter)(),r=(0,Z.PR)()||{},n=r.id,t=r.owner,i=(0,s.useState)(null),o=i[0],u=i[1],c=b.ZP.users.list({},{revalidateOnFocus:!1}),S=c.data,E=c.mutate,I=(0,s.useMemo)((function(){return(null===S||void 0===S?void 0:S.users)||[]}),[null===S||void 0===S?void 0:S.users]),D=b.ZP.users.detail(null===o||void 0===o?void 0:o.user_id,{},{revalidateOnFocus:!1}),A=D.data,T=D.mutate,M=null===A||void 0===A?void 0:A.user,N=(0,P.iV)(),q=(0,h.Z)(N);(0,s.useEffect)((function(){var e=N.add_new_user,r=N.user_id;if(!(0,x.Xy)(N,q)){var n=k(k({},q),N);r?n.user_id=r:delete n.user_id,e?n.add_new_user=e:delete n.add_new_user,u(n)}}),[N,q]);var R=null===o||void 0===o?void 0:o.add_new_user,F=(0,s.useMemo)((function(){return R?(0,C.jsx)(f.Z,{p:y.cd,children:(0,C.jsx)(w.Z,{newUser:!0,onSaveSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),E()},title:"Add new user",user:{}})}):M?(0,C.jsx)(f.Z,{p:y.cd,children:(0,C.jsx)(w.Z,{hideFields:[_.s7],onDeleteSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),E()},onSaveSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),T(),E()},showDelete:!0,title:"Edit user",user:M})}):null}),[T,E,R,M]);return(0,C.jsxs)(p.Z,{after:F,afterHidden:!M&&!R,uuidItemSelected:O.eC,uuidWorkspaceSelected:O.WH,children:[t&&(0,C.jsx)(f.Z,{p:y.cd,children:(0,C.jsx)(a.Z,{beforeIcon:(0,C.jsx)(j.mm,{}),onClick:function(){return(0,g.u7)({add_new_user:1,user_id:null})},primary:!0,children:"Add new user"})}),(0,C.jsx)(f.Z,{p:y.cd,children:(0,C.jsx)(d.Z,{children:"Users"})}),(0,C.jsx)(v.Z,{columnFlex:[1,1,1],columns:[{uuid:"Username"},{uuid:"Email"},{uuid:"Role"}],isSelectedRow:function(e){var r;return(null===(r=I[e])||void 0===r?void 0:r.id)===(null===M||void 0===M?void 0:M.id)},onClickRow:function(r){var t,i=null===(t=I[r])||void 0===t?void 0:t.id;i===n?e.push("/settings/account/profile"):+(null===o||void 0===o?void 0:o.user_id)===i?(0,g.u7)({user_id:null}):(0,g.u7)({add_new_user:null,user_id:i})},rows:I.map((function(e){var r=e.email,n=e.roles_display,t=e.roles_new,i=e.username,o=t||[];return o.sort((function(e,r){return e.id-r.id})),[(0,C.jsx)(m.ZP,{bold:!0,children:i},"username"),(0,C.jsx)(m.ZP,{default:!0,children:r},"email"),(0,C.jsx)(m.ZP,{default:!0,children:o.length>0?o[0].name:n},"roles")]})),uuid:"pipeline-runs"})]})}E.getInitialProps=(0,t.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)}))),r.default=(0,c.Z)(E)},33766:function(e,r,n){"use strict";n.d(r,{O2:function(){return c},g_:function(){return f},u7:function(){return p}});var t=n(75582),i=n(82394),o=n(34376),u=n.n(o),s=n(59e3),l=n(24224);function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function d(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,i.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var c="_offset";function p(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.preserveParams,i=r.pushHistory,o=r.replaceParams,l=(0,s.iV)(),a={};n&&n.forEach((function(e){l[e]&&(a[e]=l[e])}));var c,p=o?a:l;c=window.location.pathname;var f=i?u().push:u().replace,v=d(d({},p),e);Object.entries(e).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],i=r[1];"undefined"!==typeof i&&null!==i||delete v[n]}));var m=(0,s.uM)(v);m.length>=1&&(m="?".concat(m));var w="".concat(c.split("?")[0]).concat(m);return f(u().router.pathname,w,{shallow:!0})}function f(e,r,n){var i=n.addingMultipleValues,o=n.isList,u=n.itemsPerPage,s=n.pushHistory,a=void 0!==s&&s,f=n.resetLimitParams,v=d({},e);i?Object.entries(r).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],i=r[1];if(Array.isArray(i)){var o="".concat(n,"[]");v[o]=i.map(String)}})):o?Object.entries(r).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],i=r[1],o=String(i),u="".concat(n,"[]"),s=v[u];s&&Array.isArray(s)?(s=s.map(String)).includes(o)?v[u]=(0,l.Od)(s,(function(e){return e===o})):v[u]=s.concat(o):v[u]=[o]})):v=d(d({},v),r),f&&(v._limit=u||20,v[c]=0),p(v,{pushHistory:a})}},48673:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/workspace/users",function(){return n(60921)}])}},function(e){e.O(0,[844,7607,1424,1005,7815,3077,9774,2888,179],(function(){return r=48673,e(e.s=r);var r}));var r=e.O();_N_E=r}]);